<!DOCTYPE html>
<html lang="en" ng-app="studentManager">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>My student list</title>
    <meta name="description" content="">
    <!-- Load d3.js & color scale -->
    <script src="http://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
          integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <script src="lib/angular/angular.js"></script>
    <script src="app.module.js"></script>
    <script src="student-list/student-list.module.js"></script>
    <script src="student-list/student-list.component.js"></script>
</head>
<body>

<div class="container">

    <div class="row">

        <div class="col-md-4" id="my_graph">

        </div>
        <div class="col-md-8">

            <student-list></student-list>

        </div>
    </div>
</div>
<script>

    class Donut {

        static get defaults() {
            return {
                margin: { top: 15, right: 15, bottom: 30, left: 15 }
            };
        }

        constructor(config) {
            this.configure(config);
            this.init();
        }

        configure(config) {
            Object.assign(this, Donut.defaults, config);
        }

        init() {
            const { margin, data } = this;
            const outerWidth = 350;
            const outerHeight = 350;
            const width = outerWidth - margin.left - margin.right;
            const height = outerHeight - margin.top - margin.bottom;
            const r = Math.min(width, height) / 2;

            var nodeWidth = (d) => d.getBBox().width;


            const cScale = d3.scaleOrdinal(d3.schemeCategory20b);

            const arc = d3.arc()
                .outerRadius(r)
                .innerRadius(r - 45)
            ;

            const pie = d3.pie()
                .value(d => d.value)
            ;

            const svg = d3.select('#my_graph')
                .append('svg')
                .attr('width', outerWidth)
                .attr('height', outerHeight)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`)
            ;

            svg.append('g')
                .attr('class', 'arc')
                .attr('transform', `translate(${width/2},${height/2})`)
                .selectAll('path')
                .data(pie(data))
                .enter()
                .append('path')
                .attr('d', arc)
                .style('fill', d => cScale(d.value))
            ;

            const legend = svg.append('g')
                .attr('class', 'legend')
                .attr('transform', 'translate(0,0)');

            const lg = legend.selectAll('g')
                .data(data)
                .enter()
                .append('g')
                .attr('transform', (d,i) => `translate(${i * 100},${height + 15})`);

            lg.append('rect')
                .style('fill', d => cScale(d.value))
                .attr('x', 0)
                .attr('y', 0)
                .attr('width', 10)
                .attr('height', 10);

            lg.append('text')
                .style('font-family', 'Georgia')
                .style('font-size', '13px')
                .attr('x', 17.5)
                .attr('y', 10)
                .text(d => d.label);

            let offset = 0;
            lg.attr('transform', function(d, i) {
                let x = offset;
                offset += nodeWidth(this) + 10;
                return `translate(${x},${height + 10})`;
            });

            legend.attr('transform', function() {
                return `translate(${(width - nodeWidth(this)) / 2},${0})`
            });
        }

        render() {

        }

    }

    new Donut({
        element: 'body',
        margin: { top: 10, right: 0, bottom: 30, left: 0},
        data: [
            {label: 'Hai phong', value: 20},
            {label: 'Hai duong', value: 40},
            {label: 'Ha noi', value: 20},
            {label: 'Sai gon', value: 20}
        ]

    });
</script>
</body>
</html>
